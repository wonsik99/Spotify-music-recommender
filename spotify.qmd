---
title: "spotify"
format: html
---
# Library
```{r}
library(tidyverse)
library(dplyr)
library(ggplot2)
library(shiny)
```

# Spotify data
```{r}
# There are 1 million playlist in the main dataset
# spotify_mpd_01.RData: 0.1% of the main dataset
# spotify_mpd_001.RData: 0.001% of the main dataset
# We will start with 001 for now

load("spotify_mpd_01.RData")
# load("spotify_mpd_001.RData")

```

# track_attr
- The `track_attr` table contains information about the audio features of each track.
- These are computed by Spotify using signal processing and machine learning.
```{r}
track_attr
colnames(track_attr)
```
# filter cols, NA 
```{r}
new_track_attr <- track_attr |> 
  select(track_id, artists, track_name, danceability, energy, loudness,
         acousticness, valence, tempo, track_genre) |>
  drop_na()

new_track_attr
```

#Select 3 songs
```{r}
user_input <- new_track_attr |> 
  filter(track_id %in% c(1004300, 644949, 2188242))

user_input
```

# lm model
```{r}
train_data <- new_track_attr %>%
  mutate(liked = ifelse(track_id %in% user_input$track_id, 1, 0))

train_data

preference_model <- lm(liked ~ danceability + energy + loudness + acousticness + valence + tempo,
                       data = train_data)

preference_model |> summary()


```


```{r}
prediction_result <- new_track_attr |>
  ungroup() |>
  mutate(predicted_score = predict(preference_model, newdata = new_track_attr)) |>
  filter(!track_id %in% user_input$track_id) |> # remove input songs
  arrange(desc(predicted_score)) # order

prediction_result

best_song <- prediction_result[1, ]

print(paste("Recommnedation:", best_song$track_name, "-", best_song$artists))
print(paste("Predicted score:", round(best_song$predicted_score, 5)))
```

